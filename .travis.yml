sudo: required
services:
  - docker

  language: java

jdk: 
  - oraclejdk9

script: 
  - ./gradlew clean jar
  - 

stages: 
  - test
  - check

jobs:
  include:
    - stage: test
      script: jdk_switcher use oraclejdk9
      script: COVERAGE=0.5 ./gradlew -P ./monolithic/ui check
      script: COVERAGE=0.5 ./gradlew -P ./monolithic/service/cart check
      script: COVERAGE=0.5 ./gradlew -P ./monolithic/service/user check
      script: find . -name jacocoTestReport.csv|xargs cat|awk -F',' '{print $3" "$4" "$5}'

    - stage: check
      script: jdk_switcher use oraclejdk9
      script: COVERAGE=0.5 ./gradlew -P ./monolithic/repository/order check
      script: COVERAGE=0.5 ./gradlew -P ./monolithic/repository/cart check
      script: COVERAGE=0.35 ./gradlew -P ./monolithic/repository/product check
      script: COVERAGE=0.25 ./gradlew -P ./monolithic/repository/user check
env:
  global:
    secure: 5W6V1ga/wMhIOLDW9Cqjqzd7GdFKpCw0lBEVdvmZhwUvbBGopuHiEK0tqc3+vBF5WH+liPo73Ixu/bQeQwKqnkSrhk7N73hgEymtKOzVIfbmKKo/ixUK9es7SzV/4sAX8alAVkZxgVo/rIrpAcoZY5DT/fac3gXRlI63WtkP9mkj+H50ECBESDa6ZdTLDrSJ5GW3kYsts70yO5bZe2T4a01bFGVvMQEqGRZF2S6kt+BPwO+vSwmobXG9B2egUTHJaLstZpajaTY143RDIKCCrSXK1IYhLuUGlthcEsSi85qA346HXpOXrcBUkZSOuZtfbjlIW48udRUBLq4zi3qsJgljgKu7I8nJ9lpkKmhvuZuTuJTtkv9NjbuOuQy9Er8riwRN9xI+Tp9+httKExS3xEEdpYd0DLEbsobZ4rH0p27T/FeZQR+YdJ6fOeHXtdvxk/xyi+/JTkR9jqF2+en30TZ9nF2VNWL3pjhDSdNHqx1gq6yLP/4fG9DAvV1cKALW8Dp0dyfKheTLCr5e/nTr30wtX7mZPL2ubjZG2aThWB5MvhBxqI4/ODCmp1WuKgXGdkOuyMXavWvoCSCtNzVRyCYwCqNcBeH9QzxXEDXMxi9Vl99IAFOM4al2kCgOL1LoxlbbK/VVleubULnDUzUTpooZxF1dCDwx8W5nHqkjjZg=

deploy:
  bash -c "echo \"${DOCKER_PASSWORD}" | docker login --username \"${DOCKER_LOGIN}\" --password-stdin"
